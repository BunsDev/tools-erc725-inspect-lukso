"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[316],{316:function(e,t,n){n.d(t,{pY:function(){return Te},ZP:function(){return Ce}});var r,s,a=n(18269),o=n(93338),i=n.n(o);!function(e){e.GET_DATA_LEGACY="getDataLegacy",e.GET_DATA="getData",e.OWNER="owner",e.SUPPORTS_INTERFACE="supportsInterface",e.IS_VALID_SIGNATURE="isValidSignature"}(r||(r={})),function(e){e.BYTES="bytes",e.BYTES4="bytes4",e.BOOL="bool",e.UINT256="uint256",e.BYTES32_ARRAY="bytes32[]",e.BYTES_ARRAY="bytes[]",e.ADDRESS="address"}(s||(s={}));const c="0x2bd57b73",u="0x5a988c0f",d="0x714df77c";var l;!function(e){e.ERC725="ERC725",e.ERC725_LEGACY="ERC725_LEGACY",e.NOT_ERC725="NOT_ERC725"}(l||(l={}));const y={[r.GET_DATA_LEGACY]:{sig:"0x54f6127f",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BYTES},[r.GET_DATA]:{sig:"0x4e3e6e9c",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BYTES_ARRAY},[r.OWNER]:{sig:"0x8da5cb5b",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.ADDRESS},[r.SUPPORTS_INTERFACE]:{sig:"0x01ffc9a7",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BOOL},[r.IS_VALID_SIGNATURE]:{sig:"0x1626ba7e",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BYTES4}};var f,p;!function(e){e.KECCAK256_UTF8="keccak256(utf8)",e.KECCAK256_BYTES="keccak256(bytes)"}(f||(f={})),function(e){e.HASH_KECCAK256_UTF8="0x6f357c6a",e.HASH_KECCAK256_BYTES="0x8019f9b1"}(p||(p={}));const h=Object.values(f);const g={method:function(e){return(0,a.keccak256)(JSON.stringify(e))},name:f.KECCAK256_UTF8,sig:p.HASH_KECCAK256_UTF8},v={method:a.keccak256,name:f.KECCAK256_BYTES,sig:p.HASH_KECCAK256_BYTES},m={[f.KECCAK256_UTF8]:g,[p.HASH_KECCAK256_UTF8]:g,[f.KECCAK256_BYTES]:v,[p.HASH_KECCAK256_BYTES]:v},b={CHANGEOWNER:"0x0000000000000000000000000000000000000000000000000000000000000001",CHANGEPERMISSIONS:"0x0000000000000000000000000000000000000000000000000000000000000002",ADDPERMISSIONS:"0x0000000000000000000000000000000000000000000000000000000000000004",SETDATA:"0x0000000000000000000000000000000000000000000000000000000000000008",CALL:"0x0000000000000000000000000000000000000000000000000000000000000010",STATICCALL:"0x0000000000000000000000000000000000000000000000000000000000000020",DELEGATECALL:"0x0000000000000000000000000000000000000000000000000000000000000040",DEPLOY:"0x0000000000000000000000000000000000000000000000000000000000000080",TRANSFERVALUE:"0x0000000000000000000000000000000000000000000000000000000000000100",SIGN:"0x0000000000000000000000000000000000000000000000000000000000000200",SUPER_SETDATA:"0x0000000000000000000000000000000000000000000000000000000000000400",SUPER_TRANSFERVALUE:"0x0000000000000000000000000000000000000000000000000000000000000800",SUPER_CALL:"0x0000000000000000000000000000000000000000000000000000000000001000",SUPER_STATICCALL:"0x0000000000000000000000000000000000000000000000000000000000002000",SUPER_DELEGATECALL:"0x0000000000000000000000000000000000000000000000000000000000004000"};let E=0;const A=i();function T(e,t){const n=t.result;if("0x"===n)return null;const r=A.decodeParameter(y[e].returnEncoding,n);return Array.isArray(r)&&1===r.length&&"0x"===r[0]?[null]:r}function C(e,t,n){const r=n?y[t].sig+n.replace("0x",""):y[t].sig;return E+=1,{jsonrpc:"2.0",method:"eth_call",params:[{to:e,gas:y[t].gas,gasPrice:y[t].gasPrice,value:y[t].value,data:r}],id:E}}var k=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))};const w=i();class S{constructor(e){this.type="WEB3",this.provider=e}getOwner(e){return k(this,void 0,void 0,(function*(){const t=yield this.callContract(C(e,r.OWNER));if(t.error)throw t.error;return T(r.OWNER,t)}))}getErc725YVersion(e){return k(this,void 0,void 0,(function*(){if(yield this.supportsInterface(e,d))return l.ERC725;if(yield this.supportsInterface(e,u))return l.ERC725;return(yield this.supportsInterface(e,c))?l.ERC725_LEGACY:l.NOT_ERC725}))}supportsInterface(e,t){return k(this,void 0,void 0,(function*(){return T(r.SUPPORTS_INTERFACE,yield this.callContract(C(e,r.SUPPORTS_INTERFACE,`${t}00000000000000000000000000000000000000000000000000000000`)))}))}isValidSignature(e,t,n){return k(this,void 0,void 0,(function*(){const s=w.encodeParameters(["bytes32","bytes"],[t,n]),a=yield this.callContract([C(e,r.IS_VALID_SIGNATURE,s)]);if(a.error)throw a.error;return T(r.IS_VALID_SIGNATURE,a[0])}))}getData(e,t){return k(this,void 0,void 0,(function*(){const n=yield this.getAllData(e,[t]);try{return n[0].value}catch(r){return null}}))}getAllData(e,t){return k(this,void 0,void 0,(function*(){const n=yield this.getErc725YVersion(e);if(n===l.NOT_ERC725)throw new Error(`Contract: ${e} does not support ERC725Y interface.`);switch(n){case l.ERC725:return this._getAllData(e,t);case l.ERC725_LEGACY:return this._getAllDataLegacy(e,t);default:return[]}}))}_getAllData(e,t){return k(this,void 0,void 0,(function*(){const n=[C(e,r.GET_DATA,w.encodeParameter("bytes32[]",t))],s=yield this.callContract(n),a=T(r.GET_DATA,s[0]);return t.map(((e,t)=>({key:e,value:a[t]})))}))}_getAllDataLegacy(e,t){return k(this,void 0,void 0,(function*(){const n=[];for(let a=0;a<t.length;a++)n.push(C(e,r.GET_DATA_LEGACY,t[a]));const s=yield this.callContract(n);return n.map(((e,n)=>({key:t[n],value:T(r.GET_DATA_LEGACY,s.find((t=>e.id===t.id)))})))}))}callContract(e){return k(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{this.provider.send(e,((e,r)=>{e?n(e):t(r)}))}))}))}}var x=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))};const P=i();class ${constructor(e){this.type="ETHEREUM",this.provider=e}getOwner(e){return x(this,void 0,void 0,(function*(){const t=this.constructJSONRPC(e,r.OWNER),n=yield this.callContract([t]);if(n.error)throw n.error;return this.decodeResult(r.OWNER,n)}))}getErc725YVersion(e){return x(this,void 0,void 0,(function*(){if(yield this.supportsInterface(e,d))return l.ERC725;if(yield this.supportsInterface(e,u))return l.ERC725;return(yield this.supportsInterface(e,c))?l.ERC725_LEGACY:l.NOT_ERC725}))}supportsInterface(e,t){return x(this,void 0,void 0,(function*(){return this.decodeResult(r.SUPPORTS_INTERFACE,yield this.callContract([this.constructJSONRPC(e,r.SUPPORTS_INTERFACE,`${t}00000000000000000000000000000000000000000000000000000000`)]))}))}isValidSignature(e,t,n){return x(this,void 0,void 0,(function*(){const s=P.encodeParameters(["bytes32","bytes"],[t,n]),a=yield this.callContract([this.constructJSONRPC(e,r.IS_VALID_SIGNATURE,s)]);if(a.error)throw a.error;return this.decodeResult(r.IS_VALID_SIGNATURE,a)}))}getData(e,t){return x(this,void 0,void 0,(function*(){const n=yield this.getAllData(e,[t]);try{return n[0].value}catch(r){return null}}))}getAllData(e,t){return x(this,void 0,void 0,(function*(){const n=yield this.getErc725YVersion(e);if(n===l.NOT_ERC725)throw new Error(`Contract: ${e} does not support ERC725Y interface.`);switch(n){case l.ERC725:return this._getAllData(e,t);case l.ERC725_LEGACY:return this._getAllDataLegacy(e,t);default:return[]}}))}_getAllData(e,t){return x(this,void 0,void 0,(function*(){const n=yield this.callContract([this.constructJSONRPC(e,r.GET_DATA,P.encodeParameter("bytes32[]",t))]),s=this.decodeResult(r.GET_DATA,n);return t.map(((e,t)=>({key:e,value:s[t]})))}))}_getAllDataLegacy(e,t){return x(this,void 0,void 0,(function*(){const n=t.map((t=>this.callContract([this.constructJSONRPC(e,r.GET_DATA_LEGACY,t)])));return(yield Promise.all(n)).map(((e,n)=>({key:t[n],value:this.decodeResult(r.GET_DATA_LEGACY,e)})))}))}constructJSONRPC(e,t,n){const r=n?y[t].sig+n.replace("0x",""):y[t].sig;return{to:e,gas:y[t].gas,gasPrice:y[t].gasPrice,value:y[t].value,data:r}}callContract(e){return x(this,void 0,void 0,(function*(){return this.provider.request({method:"eth_call",params:e})}))}decodeResult(e,t){return T(e,{result:t})}}var R=n(22751);const L=/Bytes(\d+)/,_=[2,4,8,16,32,64,128,256],N=(e,t,n)=>{const r=oe(e);return(0,a.keccak256)(r.name).slice(0,10)+t.slice(2)+(0,a.utf8ToHex)(n).slice(2)},O=i(),D=e=>{const t=oe(e.slice(0,10)),n=e.replace("0x","").slice(8),r="0x"+n.slice(0,64),s=(0,a.hexToUtf8)("0x"+n.slice(64));return{hashFunction:t.name,hash:r,url:s}},I={string:{encode:e=>O.encodeParameter("string",e),decode:e=>O.decodeParameter("string",e)},address:{encode:e=>O.encodeParameter("address",e),decode:e=>O.decodeParameter("address",e)},uint256:{encode:e=>O.encodeParameter("uint256",e),decode:e=>O.decodeParameter("uint256",e)},bytes32:{encode:e=>O.encodeParameter("bytes32",e),decode:e=>O.decodeParameter("bytes32",e)},bytes4:{encode:e=>O.encodeParameter("bytes4",e),decode:e=>O.decodeParameter("bytes4",e)},bytes:{encode:e=>O.encodeParameter("bytes",e),decode:e=>O.decodeParameter("bytes",e)},"string[]":{encode:e=>O.encodeParameter("string[]",e),decode:e=>O.decodeParameter("string[]",e)},"address[]":{encode:e=>O.encodeParameter("address[]",e),decode:e=>O.decodeParameter("address[]",e)},"uint256[]":{encode:e=>O.encodeParameter("uint256[]",e),decode:e=>O.decodeParameter("uint256[]",e)},"bytes32[]":{encode:e=>O.encodeParameter("bytes32[]",e),decode:e=>O.decodeParameter("bytes32[]",e)},"bytes4[]":{encode:e=>O.encodeParameter("bytes4[]",e),decode:e=>O.decodeParameter("bytes4[]",e)},"bytes[]":{encode:e=>O.encodeParameter("bytes[]",e),decode:e=>O.decodeParameter("bytes[]",e)}},G=e=>{const t=e.match(L),n=t?parseInt(t[1],10):"";switch(e){case"Keccak256":return{type:"bytes32",encode:e=>e,decode:e=>e};case"ArrayLength":return{type:"uint256",encode:e=>(0,a.padLeft)((0,a.numberToHex)(e),64),decode:e=>(0,a.hexToNumber)(e)};case"Number":return{type:"uint256",encode:e=>{let t;try{t=parseInt(e,10)}catch(n){throw new Error(n)}return(0,a.padLeft)((0,a.numberToHex)(t),64)},decode:e=>""+(0,a.hexToNumber)(e)};case"Address":return{type:"address",encode:e=>{if((0,a.isAddress)(e))return e.toLowerCase();throw new Error('Address: "'+e+'" is an invalid address.')},decode:e=>(0,a.toChecksumAddress)(e)};case"String":case"Markdown":case"URL":return{type:"string",encode:e=>(0,a.utf8ToHex)(e),decode:e=>(0,a.hexToUtf8)(e)};case"AssetURL":return{type:"custom",encode:e=>N(e.hashFunction,e.hash,e.url),decode:e=>D(e)};case"JSONURL":return{type:"custom",encode:e=>{const{hash:t,json:n,hashFunction:r,url:s}=e;let a=t;if(n){if(r)throw new Error('When passing in the `json` property, we use "keccak256(utf8)" as a default hashingFunction. You do not need to set a `hashFunction`.');a=ie(n,f.KECCAK256_UTF8)}if(!a)throw new Error("You have to provide either the hash or the json via the respective properties");return N(r||f.KECCAK256_UTF8,a,s)},decode:e=>D(e)};case`Bytes${n}`:return{type:"bytes",encode:t=>{if("string"!==typeof t||!(0,a.isHex)(t))throw new Error(`Value: ${t} is not hex.`);if(n&&!_.includes(n))throw new Error(`Provided bytes length: ${n} for encoding valueContent: ${e} is not valid.`);if(n&&t.length!==2+2*n)throw new Error(`Value: ${t} is not of type ${e}. Expected hex value of length ${2+2*n}`);return t},decode:t=>"string"===typeof t&&(0,a.isHex)(t)?n&&!_.includes(n)?(console.error(`Provided bytes length: ${n} for encoding valueContent: ${e} is not valid.`),null):n&&t.length!==2+2*n?(console.error(`Value: ${t} is not of type ${e}. Expected hex value of length ${2+2*n}`),null):t:(console.log(`Value: ${t} is not hex.`),null)};default:return{type:"unknown",encode:t=>{throw new Error(`Could not encode unknown (${e}) valueContent.`)},decode:t=>{throw new Error(`Could not decode unknown (${e}) valueContent.`)}}}};function M(e,t){if(!I[e])throw new Error('Could not encode valueType: "'+e+'".');return t?I[e].encode(t):t}function U(e,t){if("0x"===e.slice(0,2))return e===t&&t;const n=G(e);if(!n)throw new Error(`Could not encode valueContent: ${e}.`);if(!t)return"0x";if(("AssetURL"===e||"JSONURL"===e)&&"string"===typeof t)throw new Error(`Could not encode valueContent: ${e} with value: ${t}. Expected object.`);return n.encode(t)}function H(e,t){return"0x"===e.slice(0,2)?e===t?t:null:t&&"0x"!==t?G(e).decode(t):null}const K=["<string>","<address>","<bool>"],Y=/<(uint|int|bytes)(\d+)>/,j=(e,t,n)=>{let r="",s=0;if(K.includes(e))r=e.slice(1,-1);else{const t=e.match(Y);if(!t)throw new Error(`Dynamic key: ${e} is not supported`);r=t[1],s=parseInt(t[2],10)}switch(r){case"string":return(0,a.keccak256)(t).slice(2,2+2*n);case"bool":if("true"!==t&&"false"!==t)throw new Error(`Wrong value: ${t} for dynamic key with type: <bool>. Expected "true" or "false".`);return(0,a.leftPad)(+("true"===t),2*n).slice(2);case"address":if(!(0,a.isAddress)(t))throw new Error(`Wrong value: ${t} for dynamic key with type: <address>. Value is not an address.`);return n>20?(0,a.leftPad)(t.replace("0x",""),2*n).toLowerCase():t.replace("0x","").slice(0,2*n).toLowerCase();case"uint":{if(s>256||s%8!==0)throw new Error(`Wrong dynamic key type: ${e}. 0 < M <= 256, M % 8 == 0. Got: ${s}.`);const r=(0,a.numberToHex)(parseInt(t,10)).slice(2);return r.length<=2*n?(0,a.padLeft)(r,2*n):r.slice(2*-n)}case"int":throw new Error("The encoding of <intM> has not been implemented yet.");case"bytes":{const r=t.replace("0x","");if(r.length!==2*s)throw new Error(`Wrong value: ${t} for dynamic key with type: ${e}. Value is not ${s} bytes long.`);if(!(0,a.isHex)(r))throw new Error(`Wrong value: ${t} for dynamic key with type: ${e}. Value is not in hex.`);return r.length>2*n?r.slice(0,2*n):(0,a.leftPad)(r,2*n).toLowerCase()}default:throw new Error(`Dynamic key: ${e} is not supported`)}};function V(e){const t=e.split(":");for(let n=0;n<t.length;n++)if(K.includes(t[n])||t[n].match(Y))return!0;return!1}const W=(e,t)=>{if(1!==t.length)throw new Error(`Dynamic key of type: Mapping expects exactly 1 variable. Got: ${t.length} (${t})`);const n=e.split(":");return`${(0,a.keccak256)(n[0]).slice(0,22)}0000${j(n[1],t[0],20)}`},B=(e,t)=>{const n=e.split(":");let r=0;if(V(n[1])&&(r+=1),V(n[2])&&(r+=1),r!==t.length)throw new Error(`Can not encode dynamic key of type: MappingWithGrouping. Wrong number of arguments. Expects exactly ${r} variable(s), got: ${t.length} (${t})`);const s=(0,a.keccak256)(n[0]).slice(0,14);let o="";o=V(n[1])?j(n[1],t[0],4):(0,a.keccak256)(n[1]).slice(2,10);let i="";return i=V(n[2])?j(n[2],t[t.length-1],20):(0,a.keccak256)(n[2]).slice(2,42),`${s}${o}0000${i}`};function F(e,t){if(V(e))return function(e,t){if(!t)throw new Error(`Can't encode dynamic key name: ${e} without dynamicKeyParts`);const n="string"===typeof t?[t]:t,r=ne(e);switch(r){case"Mapping":return W(e,n);case"MappingWithGrouping":return B(e,n);default:throw new Error(`Could not encode dynamic key: ${e} of type: ${r}`)}}(e,t);switch(ne(e)){case"MappingWithGrouping":{const t=e.split(":");return B(`${t[0]}:<string>:<address>`,[t[1],t[2]])}case"Mapping":{const t=e.split(":");return(0,a.isAddress)(t[1])?W(`${t[0]}:<address>`,[t[1]]):W(`${t[0]}:<string>`,[t[1]])}default:return(0,a.keccak256)(e)}}const J=(e,t,n)=>{const r=e.find((e=>e.name===t));if(!r)throw new Error(`No matching schema found for dynamic key: ${t}`);const s=F(t,n),o=((e,t)=>{let n=0;const r="string"===typeof t?[t]:t;return e.split(":").map((t=>{if(!V(t))return t;if(!r[n])throw new Error(`Can not generate key name: ${e}. Missing/not enough dynamicKeyParts: ${r}`);const s=r[n];if("<address>"===t&&!(0,a.isAddress)(s))throw new Error(`Dynamic key is expecting an <address> but got: ${s}`);return n+=1,s.replace("0x","")})).join(":")})(t,n);return Object.assign(Object.assign({},r),{key:s,name:o})};function q(e,t,n){let r;if(V(t)){if(!n)throw new Error(`Can't getSchemaElement for dynamic key: ${t} without dynamicKeyParts.`);return J(e,t,n)}r=(0,a.isHex)(t)?(0,a.isHexStrict)(t)?t:`0x${t}`:F(t);const s=e.find((e=>e.key===r));if(!s)throw new Error(`No matching schema found for key: ${t} (${r}).`);return s}const z=/bytes(\d+)/,Z=(e,t)=>{if(e.length<=2&&t.length<=2)return!1;if("("!==e[0]&&")"!==e[e.length-1]&&"("!==t[0]&&")"!==t[t.length-1])return!1;const n=e.substring(1,e.length-1).split(","),r=t.substring(1,t.length-1).split(","),s=["bytes4","bytes8","bytes16","bytes32"];if(n.length!==r.length)throw new Error(`Invalid tuple for valueType: ${e} / valueContent: ${t}. They should have the same number of elements. Got: ${n.length} and ${r.length}`);for(let o=0;o<n.length;o++){if(!s.includes(n[o]))throw new Error(`Invalid tuple for valueType: ${e} / valueContent: ${t}. Type: ${n[o]} is not valid. Valid types are: ${s}`);if("Bytes"===r[o].substring(0,5)&&r[o].toLowerCase()!==n[o])throw new Error(`Invalid tuple for valueType: ${e} / valueContent: ${t}. valueContent of type: ${r[o]} should match valueType: ${n[o]}`);if("unknown"===G(r[o]).type&&"Bytes"!==r[o].slice(0,5)&&"0x"!==r[o].slice(0,2))throw new Error(`Invalid tuple for valueType: ${e} / valueContent: ${t}. valueContent of type: ${r[o]} is not valid`);if("0x"===r[o].slice(0,2)&&!(0,a.isHex)(r[o]))throw new Error(`Invalid tuple for valueType: ${e} / valueContent: ${t}. valueContent of type: ${r[o]} is not a valid hex value`)}return!0};function Q(e,t){switch(e.keyType.toLowerCase()){case"array":{const n=[];if(!t||"string"===typeof t)return n;const r=t.find((t=>t.key===e.key));if(!r)return n;const s=se("Number","uint256",r.value,e.name)||0;for(let a=0;a<s;a++){const r=t.find((t=>t.key===te(e.key,a)));r&&n.push(se(e.valueContent,e.valueType,r.value,e.name))}return n}case"mappingwithgrouping":case"singleton":case"mapping":if(Array.isArray(t)){const n=t.find((t=>t.key===e.key));return n?se(e.valueContent,e.valueType,n.value,e.name):null}return Z(e.valueType,e.valueContent)?((e,t,n)=>{const r=t.substring(1,t.length-1).split(","),s=e.substring(1,e.length-1).split(","),a=[];r.forEach((e=>{const t=e.match(z);t&&a.push(parseInt(t[1],10))}));const o=a.reduce(((e,t)=>e+t),0);if(n.length!==2+2*o)return console.error(`Trying to decode a value: ${n} which does not match the length of the valueType: ${t}. Expected ${o} bytes.`),[];let i=2;const c=a.map((e=>{const t=n.substring(i,i+2*e);return i+=2*e,`0x${t}`}));return s.map(((e,t)=>se(e,r[t],c[t])))})(e.valueContent,e.valueType,t):se(e.valueContent,e.valueType,t,e.name);default:return console.error('Incorrect data match or keyType in schema from decodeKey(): "'+e.keyType+'"'),null}}function X(e,t){const n=({keyName:e,dynamicKeyParts:n,value:r})=>{let s;return V(e)?(s=q(t,e,n),{key:s.key,name:s.name,value:Q(s,r)}):(s=q(t,e),{key:s.key,name:s.name,value:Q(s,r)})};return Array.isArray(e)?e.map((e=>n(e))):n(e)}function ee(e,t,n,r){if(!(!!G(e)||"0x"===e.slice(0,2)))throw new Error(`The valueContent '${e}' \n            for ${r} is not supported.`);const s="[]"===t.slice(t.length-2);if(!s&&!Array.isArray(n))return U(e,n);const a=G(e),o=a&&a.type===t.split("[]")[0];let i;if(Array.isArray(n)){const t=[];for(let r=0;r<n.length;r++){const s=n[r];t.push(U(e,s))}i=t}return"bytes"===t||o?s&&o&&(i=M(t,n)):i=M(t,i),i}function te(e,t){return e.slice(0,34)+(0,a.padLeft)((0,a.numberToHex)(t),32).replace("0x","")}function ne(e){const t=e.split(":");return 3===t.length?"MappingWithGrouping":2===t.length?"Mapping":"[]"===e.substring(e.length-2,e.length)?"Array":"Singleton"}function re(e,t){switch(e.keyType.toLowerCase()){case"array":{if(!Array.isArray(t))return console.error("Can't encode a non array for key of type array"),null;const n=[];for(let r=0;r<t.length;r++){const s=t[r];0===r&&n.push({key:e.key,value:ee("Number","uint256",t.length.toString(),e.name)}),n.push({key:te(e.key,r),value:ee(e.valueContent,e.valueType,s,e.name)})}return n}case"mappingwithgrouping":case"singleton":case"mapping":if(Z(e.valueType,e.valueContent)){if(!Array.isArray(t))throw new Error(`Incorrect value for tuple. Got: ${t}, expected array.`);return((e,t,n)=>{const r=t.substring(1,t.length-1).split(","),s=e.substring(1,e.length-1).split(",");if(r.length!==n.length)throw new Error(`Can not encode tuple key value: ${n}. Expecte array of length: ${r.length}`);return"0x"+s.map(((e,t)=>{const s=ee(e,r[t],n[t]);if(!s)return"";const o=parseInt(r[t].substring(5),10);return s.length>2+2*o?s.slice(s.length-2*o):(0,a.padLeft)(s,2*o).replace("0x","")})).join("")})(e.valueContent,e.valueType,t)}return ee(e.valueContent,e.valueType,t,e.name);default:return console.error('Incorrect data match or keyType in schema from encodeKey(): "'+e.keyType+'"'),null}}function se(e,t,n,r){const s=G(e);if(!s&&"0x"!==e.slice(0,2))throw new Error('The valueContent "'+e+'" for "'+r+'" is not supported.');let o=s&&s.type===t.split("[]")[0];const i="[]"===t.substring(t.length-2);if("bytes"===t.slice(0,5)&&"[]"!==t.slice(-2)||"string"===t||(0,a.isAddress)(n)||(n=function(e,t){if(!I[e])throw new Error('Could not decode valueType: "'+e+'".');return"0x"===t?null:t?I[e].decode(t):t}(t,n)),o&&(0,a.isAddress)(n)&&!(0,a.checkAddressChecksum)(n)&&(o=!o),o&&"string"!==t)return n;if(i&&Array.isArray(n)){const t=[];for(let r=0;r<n.length;r++){const s=n[r];t.push(H(e,s))}return t}return H(e,n)}function ae(e,t){return(Array.isArray(e)?e:[e]).reduce(((e,{keyName:n,value:r,dynamicKeyParts:s})=>{let a,o=null;if(V(n)){if(!s)throw new Error(`Can't encodeData for dynamic key: ${n} with non dynamic values. Got: ${r}, expected object.`);o=q(t,n,s),a=re(o,r)}else o=q(t,n),a=re(o,r);return"string"===typeof a?(e.keys.push(o.key),e.values.push(a)):!1!==a&&null!==a&&a.forEach((t=>{e.keys.push(t.key),e.values.push(t.value)})),e}),{keys:[],values:[]})}function oe(e){const t=m[e];if(!t)throw new Error(`Chosen hashFunction '${e}' is not supported. Supported hashFunctions: ${h}`);return t}function ie(e,t){return oe(t).method(e)}function ce(e){let t=e;return e.endsWith("/")&&!e.endsWith("/ipfs/")?t=e+"ipfs/":e.endsWith("/ipfs")?t=e+"/":e.endsWith("/ipfs/")||(t=e+"/ipfs/"),t}const ue=(e,t)=>e.map((e=>"string"===typeof e?q(t,e):q(t,e.keyName,e.dynamicKeyParts)));var de=JSON.parse('[{"name":"LSP1UniversalReceiverDelegate","key":"0x0cfc51aec37c55a4d0b1a65c6255c4bf2fbdf6277f3cc0730c45b828b6db8b47","keyType":"Singleton","valueType":"address","valueContent":"Address"}]'),le=JSON.parse('[{"name":"SupportedStandards:LSP3UniversalProfile","key":"0xeafec4d89fa9619884b60000abe425d64acd861a49b8ddf5c0b6962110481f38","keyType":"Mapping","valueType":"bytes4","valueContent":"0xabe425d6"},{"name":"LSP3Profile","key":"0x5ef83ad9559033e6e941db7d7c495acdce616347d28e90c7ce47cbfcfcad3bc5","keyType":"Singleton","valueType":"bytes","valueContent":"JSONURL"},{"name":"LSP12IssuedAssets[]","key":"0x7c8c3416d6cda87cd42c71ea1843df28ac4850354f988d55ee2eaa47b6dc05cd","keyType":"Array","valueType":"address","valueContent":"Address"},{"name":"LSP12IssuedAssetsMap:<address>","key":"0x74ac2555c10b9349e78f0000<address>","keyType":"Mapping","valueType":"(bytes4,bytes8)","valueContent":"(Bytes4,Number)"},{"name":"LSP5ReceivedAssetsMap:<address>","key":"0x812c4334633eb816c80d0000<address>","keyType":"Mapping","valueType":"(bytes4,bytes8)","valueContent":"(Bytes4,Number)"},{"name":"LSP5ReceivedAssets[]","key":"0x6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b","keyType":"Array","valueType":"address","valueContent":"Address"},{"name":"LSP1UniversalReceiverDelegate","key":"0x0cfc51aec37c55a4d0b1a65c6255c4bf2fbdf6277f3cc0730c45b828b6db8b47","keyType":"Singleton","valueType":"address","valueContent":"Address"}]'),ye=JSON.parse('[{"name":"SupportedStandards:LSP4DigitalCertificate","key":"0xeafec4d89fa9619884b6b89135626455000000000000000000000000abf0613c","keyType":"Mapping","valueContent":"0xabf0613c","valueType":"bytes"}]'),fe=JSON.parse('[{"name":"SupportedStandards:LSP4DigitalAsset","key":"0xeafec4d89fa9619884b60000a4d96624a38f7ac2d8d9a604ecf07c12c77e480c","keyType":"Mapping","valueType":"bytes4","valueContent":"0xa4d96624"},{"name":"LSP4TokenName","key":"0xdeba1e292f8ba88238e10ab3c7f88bd4be4fac56cad5194b6ecceaf653468af1","keyType":"Singleton","valueType":"string","valueContent":"String"},{"name":"LSP4TokenSymbol","key":"0x2f0a68ab07768e01943a599e73362a0e17a63a72e94dd2e384d2c1d4db932756","keyType":"Singleton","valueType":"string","valueContent":"String"},{"name":"LSP4Metadata","key":"0x9afb95cacc9f95858ec44aa8c3b685511002e30ae54415823f406128b85b238e","keyType":"Singleton","valueType":"bytes","valueContent":"JSONURL"},{"name":"LSP4Creators[]","key":"0x114bd03b3a46d48759680d81ebb2b414fda7d030a7105a851867accf1c2352e7","keyType":"Array","valueType":"uint256","valueContent":"Number"},{"name":"LSP4CreatorsMap:<address>","key":"0x6de85eaf5d982b4e5da00000<address>","keyType":"Mapping","valueType":"(bytes4,bytes8)","valueContent":"(Bytes4,Number)"}]'),pe=JSON.parse('[{"name":"LSP5ReceivedAssetsMap:<address>","key":"0x812c4334633eb816c80d0000<address>","keyType":"Mapping","valueType":"(bytes4,bytes8)","valueContent":"(Bytes4,Number)"},{"name":"LSP5ReceivedAssets[]","key":"0x6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b","keyType":"Array","valueType":"address","valueContent":"Address"}]'),he=JSON.parse('[{"name":"AddressPermissions[]","key":"0xdf30dba06db6a30e65354d9a64c609861f089545ca58c6b4dbe31a5f338cb0e3","keyType":"Array","valueType":"address","valueContent":"Address"},{"name":"AddressPermissions:Permissions:<address>","key":"0x4b80742de2bf82acb3630000<address>","keyType":"MappingWithGrouping","valueType":"bytes32","valueContent":"BitArray"},{"name":"AddressPermissions:AllowedAddresses:<address>","key":"0x4b80742de2bfc6dd6b3c0000<address>","keyType":"MappingWithGrouping","valueType":"address[]","valueContent":"Address"},{"name":"AddressPermissions:AllowedFunctions:<address>","key":"0x4b80742de2bf8efea1e80000<address>","keyType":"MappingWithGrouping","valueType":"bytes4[]","valueContent":"Bytes4"},{"name":"AddressPermissions:AllowedStandards:<address>","key":"0x4b80742de2bf3efa94a30000<address>","keyType":"MappingWithGrouping","valueType":"bytes4[]","valueContent":"Bytes4"},{"name":"AddressPermissions:AllowedERC725YKeys:<address>","key":"0x4b80742de2bf90b8b4850000<address>","keyType":"MappingWithGrouping","valueType":"bytes4[]","valueContent":"Bytes4"}]'),ge=de.concat(le,ye,fe,pe,he);function ve(e,t){const n=(e=>({Singleton:e.filter((e=>"Singleton"===e.keyType)),Array:e.filter((e=>"Array"===e.keyType)),Mapping:e.filter((e=>"Mapping"===e.keyType)),MappingWithGrouping:e.filter((e=>"MappingWithGrouping"===e.keyType))}))(t);let r=null;return r=((e,t)=>t.find((t=>t.key===e))||null)(e,n.Singleton),r||(r=((e,t)=>{const n=t.find((t=>t.key===e))||null;if(n)return n;const r=e.substring(0,34),s=t.find((e=>e.key.substring(0,34)===r))||null;if(!s)return null;if(!/^\d+$/.test(e.substring(34)))return null;const a=parseInt(e.substring(34),10);return Object.assign(Object.assign({},s),{key:e,name:s.name.replace("[]",`[${a}]`),keyType:"Singleton"})})(e,n.Array),r||(r=((e,t)=>{let n=t.find((t=>t.key===e))||null;return n||(n=t.find((t=>`${t.key.substring(0,22)}0000`===e.substring(0,26)))||null,n?Object.assign(Object.assign({},n),{valueContent:"?",name:`${n.name.split(":")[0]}:??????`,key:e}):null)})(e,n.Mapping),r||(r=((e,t)=>{const n=t.find((t=>t.key.substring(0,26)===e.substring(0,26)))||null,r=e.substring(26);return n?Object.assign(Object.assign({},n),{key:e,name:`${n.name.substring(0,n.name.lastIndexOf(":"))}:${r}`}):null})(e,n.MappingWithGrouping),r)))}var me=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))};var be=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))};const Ee=(e,t,n)=>{const r=t.map((t=>be(void 0,void 0,void 0,(function*(){const r=e.find((e=>e.key===t.key));if(!r)return t;if(!["jsonurl","asseturl"].includes(r.valueContent.toLowerCase()))return t;if("string"===typeof t.value)return console.error(`Value of key: ${t.name} (${t.value}) is string but valueContent is: ${r.valueContent}. Expected type should be object with url key.`),t;if(!t.value)return t;if(Array.isArray(t.value))return console.error(`Value of key: ${t.name} (${t.value}) is string[] but valueContent is: ${r.valueContent}. Expected type should be object with url key.`),t;const s=t.value;let a;try{const{url:e}=function(e,t){return e&&e.url&&-1!==e.url.indexOf("ipfs://")?Object.assign(Object.assign({},e),{url:e.url.replace("ipfs://",t)}):e}(s,n);a=yield fetch(e).then((e=>be(void 0,void 0,void 0,(function*(){return s.hashFunction===f.KECCAK256_BYTES?e.arrayBuffer().then((e=>new Uint8Array(e))):e.json()}))))}catch(o){throw console.error(o,`GET request to ${s.url} failed`),o}return function(e,t,n){let r;return r=e instanceof Uint8Array?ie((0,R.arrToBufArr)(e),n):ie(e,n),r===t||(console.error(`Hash mismatch, returned JSON hash ("${r}") is different from expected hash: "${t}"`),!1)}(a,s.hash,s.hashFunction)?Object.assign(Object.assign({},t),{value:a}):Object.assign(Object.assign({},t),{value:null})}))));return Promise.all(r)};var Ae=function(e,t,n,r){return new(n||(n=Promise))((function(s,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))};class Te{constructor(e,t,n,r){if(!e)throw new Error("Missing schema.");this.options={schemas:this.validateSchemas(e),address:t,provider:this.initializeProvider(n),ipfsGateway:(null===r||void 0===r?void 0:r.ipfsGateway)?ce(null===r||void 0===r?void 0:r.ipfsGateway):"https://cloudflare-ipfs.com/ipfs/"}}validateSchemas(e){return e.filter((e=>{try{const t=F(e.name),n=e.key===t;return n||console.log(`The schema with keyName: ${e.key} is skipped because its key hash does not match its key name (expected: ${t}, got: ${e.key}).`),n}catch(t){return!0}}))}initializeProvider(e){if(e){if("function"===typeof e.request)return new $(e);if(!e.request&&"function"===typeof e.send)return new S(e);throw new Error(`Incorrect or unsupported provider ${e}`)}}getData(e){return Ae(this,void 0,void 0,(function*(){if(this.getAddressAndProvider(),e||(e=this.options.schemas.map((e=>e.name)).filter((e=>!V(e)))),Array.isArray(e))return this.getDataMultiple(e);return(yield this.getDataMultiple([e]))[0]}))}fetchData(e){return Ae(this,void 0,void 0,(function*(){let t;t=Array.isArray(e)?e:e?[e]:this.options.schemas.map((e=>e.name)).filter((e=>!V(e)));const n=yield this.getData(t),r=ue(t,this.options.schemas),s=yield Ee(r,n,this.options.ipfsGateway);return e&&!Array.isArray(e)&&s.length>0?s[0]:s}))}getSchema(e,t){return function(e,t){let n=ge;return t&&(n=n.concat(t)),Array.isArray(e)?e.reduce(((e,t)=>(e[t]=ve(t,n),e)),{}):ve(e,n)}(e,this.options.schemas.concat(t||[]))}encodeData(e,t){return ae(e,Array.prototype.concat(this.options.schemas,t))}static encodeData(e,t){return ae(e,t)}decodeData(e,t){return X(e,Array.prototype.concat(this.options.schemas,t))}static decodeData(e,t){return X(e,t)}getOwner(e){return Ae(this,void 0,void 0,(function*(){const{address:t,provider:n}=this.getAddressAndProvider();return n.getOwner(e||t)}))}isValidSignature(e,t){return Ae(this,void 0,void 0,(function*(){if(!this.options.address||!(0,a.isAddress)(this.options.address))throw new Error("Missing ERC725 contract address.");if(!this.options.provider)throw new Error("Missing provider.");return((e,t,n,r)=>me(void 0,void 0,void 0,(function*(){const s=function(e){return/^0x([A-Fa-f0-9]{64})$/.test(e)}(e)?e:(0,a.keccak256)(`\x19Ethereum Signed Message:\n${e.length}${e}`);if(132!==t.length)throw new Error("Signature length should be 132 (65bytes)");try{return"0x1626ba7e"===(yield r.isValidSignature(n,s,t))}catch(o){throw new Error(`Error when checking signature. Is ${n} a valid contract address which supports EIP-1271 standard?`)}})))(e,t,this.options.address,this.options.provider)}))}getArrayValues(e,t){var n;return Ae(this,void 0,void 0,(function*(){if("Array"!==e.keyType)throw new Error(`The "getArrayValues" method requires a schema definition with "keyType: Array",\n         ${e}`);const r=[],s=t[e.key];if(!s||!s.value)return r;const a=yield se("Number","uint256",s.value,e.name),o=[];for(let n=0;n<a;n++){const r=te(e.key,n);t[r]||o.push(r)}try{const e=yield null===(n=this.options.provider)||void 0===n?void 0:n.getAllData(this.options.address,o);r.push(...e)}catch(i){}return r}))}getDataMultiple(e){var t;return Ae(this,void 0,void 0,(function*(){const n=ue(e,this.options.schemas),r=(yield null===(t=this.options.provider)||void 0===t?void 0:t.getAllData(this.options.address,n.map((e=>e.key)))).reduce(((e,t)=>(e[t.key]=t.value,e)),{}),s=n.map((e=>Object.assign(Object.assign({},e),{value:r[e.key]||null}))),a=n.filter((e=>"array"===e.keyType.toLowerCase()));for(const e of a){const t={[e.key]:{key:e.key,value:r[e.key]}},n=yield this.getArrayValues(e,t);n&&n.length>0&&(n.push(t[e.key]),s[s.findIndex((t=>t.key===e.key))]=Object.assign(Object.assign({},e),{value:n}))}return X(s.map((({key:e,value:t})=>({keyName:e,value:t}))),n)}))}getAddressAndProvider(){if(!this.options.address||!(0,a.isAddress)(this.options.address))throw new Error("Missing ERC725 contract address.");if(!this.options.provider)throw new Error("Missing provider.");return{address:this.options.address,provider:this.options.provider}}static encodePermissions(e){const t=Object.keys(e).reduce(((t,n)=>e[n]?t+(0,a.hexToNumber)(b[n]):t),0);return(0,a.leftPad)((0,a.toHex)(t),64)}encodePermissions(e){return Te.encodePermissions(e)}static decodePermissions(e){const t={CHANGEOWNER:!1,CHANGEPERMISSIONS:!1,ADDPERMISSIONS:!1,SETDATA:!1,CALL:!1,STATICCALL:!1,DELEGATECALL:!1,DEPLOY:!1,TRANSFERVALUE:!1,SIGN:!1,SUPER_SETDATA:!1,SUPER_TRANSFERVALUE:!1,SUPER_CALL:!1,SUPER_STATICCALL:!1,SUPER_DELEGATECALL:!1},n=Object.keys(b);if("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"===e)return n.forEach((e=>{t[e]=!0})),t;const r=(0,a.hexToNumber)(e);return n.forEach((e=>{const n=(0,a.hexToNumber)(b[e]),s=(r&n)===n;t[e]=s})),t}decodePermissions(e){return Te.decodePermissions(e)}static encodeKeyName(e){return F(e)}encodeKeyName(e){return F(e)}}var Ce=Te}}]);